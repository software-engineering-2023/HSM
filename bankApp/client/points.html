<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="../universalstyles.css">
  <title>My Page</title>
  <style>
    
    table {
      border-collapse: collapse;
      width: 60%;
      margin: auto;
    }
    
    th, td {
      border: 1px solid black;
      padding: 10px;
    }
    
    th {
      text-align: center;
    }
    
    td {
      text-align: left;
    }

    form {
        max-width: 400px;
        margin: auto;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-shadow: 0 0 5px #ccc;
        font-family: Arial, sans-serif;
        font-size: 16px;
        line-height: 1.5;
        }
        
        label {
          display: block;
          margin-bottom: 10px;
          font-weight: bold;
        }

          input[type="submit"] {
          background-color: #006280;
          color: #fff;
          padding: 10px 20px;
          border: none;
          border-radius: 5px;
          box-shadow: 0 0 5px #ccc;
          cursor: pointer;
          font-family: Arial, sans-serif;
          font-size: 16px;
          line-height: 1.5;
        }
        input[type="submit"]:hover {
          background-color: #005069;
        }

        input[type="text"], select {
        display: block;
        margin-bottom: 20px;
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        box-sizing: border-box;
        font-family: sans-serif;
        font-size: 16px;
        line-height: 1.5;
        width: 100%;
      }

      h1 {
            text-align: center;
        } 

  </style>
</head>
<body>
  <header>
      <div class="header">
          <div class="dropdown">
              <button class="notification-button" onclick="window.location='notifications.html'">
                  <img id="bell" src="../Bell.png" alt="bell">
              </button>
              <div class="dropdown-content">
                  <a href="#">Announcement: Updated terms and conditions</a>
                  <a href="#">Reminder: Pay electricity bill</a>
                  <a href="#">Issue Resolution: Thank you for reaching out to be...</a>
              </div>
          </div>
          
          <img id="logo" src="../logo_text.png" alt="Logo">

          <button class="logout-button" onclick="window.location='../loginPage.html'">
              <img id="logout" src="../logout.png" alt="logout">
          </button>
      </div>

      <div class="sidebar" id="sidebar-id">
          <ul>
              <br><br><br><br>
              <li><a href="client.html">Home</a></li>
              <br>
              <li><a href="transfer.html">Transfer</a></li>
              <br>
              <li><a href="accounts.html">Accounts</a></li>
              <br>
              <li><a href="loan.html">Loans</a></li>
              <br>
              <li><a href="cards.html">Cards</a></li>
              <br>
              <li><a href="viewReminders.html">Reminders</a></li>
              <br>
              <li><a href="bills.html">Bills</a></li>
              <br><br><br>
              <li><a href="../loginPage.html">Log Out</a></li>
          </ul>
      </div>
      <button class="sidebar-button" id="sidebar-button-id">
          <img id="menu-logo" src="../menu.png" alt="menu">
      </button>

      </div>

  </header>
      
  <main class="main-area">
    <br>
  <div style="text-align:center;">
      <h1 style="color: black; font-weight: bold; font-family: 'Times New Roman', Times, serif; font-size: 40px;">My Points</h1>
  </div>

  <div style="text-align: left;">
    <p style="margin-left:200px; font-size: 20px;">Total points:</p> <p style="margin-left:200px; font-size: 30px;" id="total-page-points">1500</p>
  </div>
  <table id="table-id">
    <thead>
      <tr>
        <th>Date</th>
        <th>Earned</th>
        <th>Redeemed</th>
      </tr>
    </thead>
    <tbody>
      <td>25-05-2023</td>
        <td>1500</td>
        <td>0</td>
      </tr>
      <!-- <tr>
        <td>2023-05-22</td>
        <td>+1000</td>
        <td>0</td>
      </tr>
      <tr>
        <td>2023-05-21</td>
        <td>0</td>
        <td>-500</td>
      </tr>
      <tr>
        <td>2023-05-20</td>
        <td>+500</td>
        <td>0</td>
      </tr>
      <tr>
        <td>2023-05-19</td>
        <td>+200</td>
        <td>0</td>
      </tr>
      <tr>
        <td>2023-05-18</td>
        <td>0</td>
        <td>-200</td>
      </tr> -->
    </tbody>
  </table>
  <br><br>

<div style="text-align:center;">
  <h1 style="color: black; font-weight: bold; font-family: 'Times New Roman', Times, serif; font-size: 25px;">Redeem Points</h1>
</div>

<form onsubmit="redeemPoints(event)">
  <label for="redeem-acc">Target Account:</label>
  <select id="redeem-acc" name="redeem-acc" required>
    <option value="" disabled required selected>Choose an account</option>
    <option value="111111111111">111111111111</option>
    <option value="222222222222">222222222222</option>
    <option value="333333333333">333333333333</option>
  </select><br>

<label for="redeem-amount">Points to Redeem:</label>
<select id="redeem-amount" name="redeem-amount" required>
  <option value="" disabled required selected>Select an amount</option>
  <option value="1000">1000</option>
  <option value="5000">5000</option>
  <option value="10000">10000</option>
</select><br>

<input class="extra-button" type="submit" value="Redeem Points"/>
</form>
<br>
<div style="text-align: center;">
<button class="redirect-button" onclick="window.location='cards.html'">Back to Cards</button>
</div>


    <br><br><br><br>
    <div class="footer">
        <footer>
            <br><br>
            <a href="atm.html">ATM Locator</a> | <a href="settings.html">Settings</a> | <a href="contactus.html">Contact Us &phone;</a>
            <br><br><br>
            &copy; 2023 HSM Bank. All rights reserved.
            <br><br><br>
            <img id="flower" src="../Flower.png" alt="Logo">
        </footer>
    </div>
    <div class="rightbar"> </div>
  </main>

    <script>

      document.addEventListener("DOMContentLoaded", function() {
        var element = document.getElementById("total-page-points");
        element.textContent = localStorage.getItem("total-points");

        var tableBody = document.querySelector("#table-id tbody");
        var savedTransactions = JSON.parse(localStorage.getItem("points-transactions"));
        if (savedTransactions && savedTransactions.length > 0) {
				  savedTransactions.forEach(function(transaction) {
					var row = document.createElement("tr");
					row.innerHTML = `
					<td>${transaction.Date}</td>
					<td>${transaction.Earned}</td>
          <td>${transaction.Redeemed}</td>
					`;

					// Append the row to the table body
					tableBody.appendChild(row);
				});
			}

			});

      function redeemPoints(event){
        event.preventDefault();
        var acc = document.getElementById("redeem-acc").value; //222222
        var balanceid; //2-balance <--id that we need for balance
        if(acc == "222222222222"){
          balanceid="2-balance";
        }else if(acc == "111111111111"){
          balanceid="1-balance";
        }else{
          balanceid="3-balance";
        }

        var amount = parseInt(document.getElementById("redeem-amount").value); //1000 points
        var points_on_hand = parseInt(localStorage.getItem("total-points")); //1500 points
        var money;
        if(amount==1000){
          money=50;
        }else if(amount==5000){
          money=400;
        }else{
          money=1000;
        }

        if(amount>points_on_hand){
                alert("You do not have enough points for this transaction.")

            }else{
                alert("Successful Transaction. (Refresh for an updated Points Schedule)");

                updateBalance(balanceid, amount, points_on_hand, money);
                updateTransaction(acc, balanceid, amount, points_on_hand, money);
                var element = document.getElementById("total-page-points");
			          element.textContent = localStorage.getItem("total-points");
                resetForm();
            }
      }

      function resetForm() {
            document.getElementById("redeem-acc").value = "";
            document.getElementById("redeem-amount").value = "";
        }


        function updateBalance(balanceid, amount, points_on_hand, money){
            var storedBalance = parseFloat(localStorage.getItem(balanceid)); //10000.00

            var newbalance=parseFloat(storedBalance) + parseFloat(money); //10000.00 + 50.00 =10050.00
            localStorage.setItem(balanceid, newbalance.toFixed(2)); 

            var totalPoints = parseInt(localStorage.getItem("total-points")); //1500
            var newPoints = totalPoints - parseInt(amount); //1500-1000
            localStorage.setItem("total-points", newPoints.toFixed());
        }

        function updateTransaction(accid, balanceid, amount, points_on_hand, money){
            var newtransaction =
            {
                "Date": "01-06-2023",
                "Earned": 0,
                "Redeemed": parseInt(amount)
            };

            var transactionsP = JSON.parse(localStorage.getItem("points-transactions")) || [];
            
            transactionsP.unshift(newtransaction);
            localStorage.setItem("points-transactions", JSON.stringify(transactionsP));

            
            var newtransaction =
            {
                "Date": "01-06-2023",
                "Amount": parseFloat(money)
            };

            var transid;
            if(accid == "222222222222"){
                transid="transactions2";
            }else if(accid == "111111111111"){
                transid="transactions1";
            }else{
                transid="transactions3";
            }


            var transactions = JSON.parse(localStorage.getItem(transid)) || [];
            
            transactions.unshift(newtransaction);
            localStorage.setItem(transid, JSON.stringify(transactions));
            
        }      

        

      var sidebartmp = document.getElementById("sidebar-id");
      var sidebarbuttontmp = document.getElementById("sidebar-button-id");
      sidebarbuttontmp.addEventListener("click", () => {
          if(sidebartmp.style.width === "45px"){
              sidebartmp.style.width = "200px";
              sidebarbuttontmp.style.left="180px";
          }else{
              sidebartmp.style.width = "45px";
              sidebarbuttontmp.style.left="23px";
          }
      });

  </script>

</html>
