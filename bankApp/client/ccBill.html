<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="../universalstyles.css">
    <title>Credit Card Bill Payment</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }
      #header {
        text-align: center;
        padding: 20px;
      }
      #options {
        text-align: center;
        margin-top: 50px;
      }
      .extra-button {
        border-radius: 10px;
      }
      .popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: white;
        border: 1px solid lightgray;
        padding: 20px;
        text-align: center;
        border-radius: 10px;
      }
      .popup .title {
        font-size: 20px;
        margin-bottom: 10px;
      }
      .popup .dropdown {
        margin-bottom: 10px;
      }
      .popup .cancel {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background-color: darkred;
        color: white;
        padding: 5px 10px;
        font-size: 14px;
        border-radius: 10px;
        cursor:pointer;
      }
      .popup .cancel:hover {
        background-color: rgb(107, 0, 0);
      }
      .popup .confirm {
        margin-top: 10px;
        position: absolute;
        bottom: 10px;
        background-color: #45a049;
        color: white;
        padding: 5px 10px;
        font-size: 14px;
        border-radius: 10px;
        cursor:pointer;
      }
      .popup .confirm:hover {
        background-color: #3b873f;
      }
      .popup .input-box {
        margin-bottom: 10px;
        cursor:pointer;
      }
      .popup .input-box input[type="number"] {
        padding: 5px;
        width: 200px;
      }
      .popup .input-box input[type="number"]:hover::before {
        content: "The minimum amount to pay is 5,000.00";
        position: absolute;
        top: -25px;
        left: -15px;
        padding: 5px;
        background-color: lightgray;
        color: black;
        font-size: 14px;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <header>
        <div class="header">
            <div class="dropdown">
                <button class="notification-button" onclick="window.location='notifications.html'">
                    <img id="bell" src="../Bell.png" alt="bell">
                </button>
                <div class="dropdown-content">
                    <a href="#">Announcement: Updated terms and conditions</a>
                    <a href="#">Reminder: Pay electricity bill</a>
                    <a href="#">Issue Resolution: Thank you for reaching out to be...</a>
                </div>
            </div>
            
            <img id="logo" src="../logo_text.png" alt="Logo">

            <button class="logout-button" onclick="window.location='../loginPage.html'">
                <img id="logout" src="../logout.png" alt="logout">
            </button>
        </div>

        <div class="sidebar" id="sidebar-id">
            <ul>
                <br><br><br><br>
                <li><a href="client.html">Home</a></li>
                <br>
                <li><a href="transfer.html">Transfer</a></li>
                <br>
                <li><a href="accounts.html">Accounts</a></li>
                <br>
                <li><a href="loan.html">Loans</a></li>
                <br>
                <li><a href="cards.html">Cards</a></li>
                <br>
                <li><a href="viewReminders.html">Reminders</a></li>
                <br>
                <li><a href="bills.html">Bills</a></li>
                <br><br><br>
                <li><a href="../loginPage.html">Log Out</a></li>
            </ul>
        </div>
        <button class="sidebar-button" id="sidebar-button-id">
            <img id="menu-logo" src="../menu.png" alt="menu">
        </button>

        </div>

    </header>
        
    <main class="main-area">

    <div id="header">
      <h1 style="color: black; font-weight: bold; font-family: 'Times New Roman', Times, serif; font-size: 40px;">Credit Card Bill Payment</h1>
      <div class="amount">Amount Due:</div> <div id="ccbill1page"> 7000.00 </div>
    </div>
    <div id="options">
      <h2>Payment Options:</h2>
      <button class="extra-button" id="full-amount-btn">Pay Amount Fully</button>
      <button class="extra-button" id="partial-amount-btn">Pay Amount Partially</button>
    <br>
    <button class="redirect-button" onclick="window.location='bills.html'">Go to All Bills</button>
   <button class="redirect-button" onclick="window.location='cards.html'">Go to Cards</button>
  </div>

    <div id="full-amount-pay" class="popup">
      <h4 class="title">Choose the account you want to pay from:</h4>
      <div class="dropdown">
        <label for="account-select-full">Your Accounts:</label>
        <select id="account-select-full" required>
          <option value="Acc No." disabled selected>Acc No.</option>
          <option value="111111111111">111111111111</option>
          <option value="222222222222">222222222222</option>
          <option value="333333333333">333333333333</option>
        </select>
      </div>
      <br><br>
      <button class="confirm button" onclick="payFullAmount()">Confirm Payment</button>
      <button class="cancel button">Cancel</button>
    </div>
    <div id="partial-amount-pay" class="popup">
      <h4 class="title">Enter the amount you want to pay:</h4>
      <div class="input-box">
        <input type="number" min="5000" max="30000" step="0.01" placeholder="Enter amount" id="payment-amount">
      </div>
      <h4 class="title">Choose the account you want to pay from:</h4>
      <div class="dropdown">
        <label for="account-select-partial">Your Accounts:</label>
        <select id="account-select-partial" required>
          <option value="Acc No." disabled selected>Acc No.</option>
          <option value="111111111111">111111111111</option>
          <option value="222222222222">222222222222</option>
          <option value="333333333333">333333333333</option>
        </select>
      </div>
      <br><br>
      <button class="confirm button" onclick="payPartialAmount()">Confirm Payment</button>
      <button class="cancel button">Cancel</button>
    </div>
  </main>
    
  <br><br><br><br>
  <div class="footer">
    <footer>
      <br><br>
      <a href="atm.html">ATM Locator</a> | <a href="settings.html">Settings</a> | <a href="contactus.html">Contact Us &phone;</a>
      <br><br><br>
      &copy; 2023 HSM Bank. All rights reserved.
      <br><br><br>
      <img id="flower" src="../Flower.png" alt="Logo">
  </footer>
  </div>
  <div class="rightbar"> </div>

    <script>
      const fullAmountBtn = document.getElementById('full-amount-btn');
      const partialAmountBtn = document.getElementById('partial-amount-btn');
      const fullAmountPay = document.getElementById('full-amount-pay');
      const partialAmountPay = document.getElementById('partial-amount-pay');
      const cancelBtns = document.querySelectorAll('.popup .cancel');
      const fullAmountConfirmBtn = document.querySelector('#full-amount-pay .confirm');
      const partialAmountConfirmBtn = document.querySelector('#partial-amount-pay .confirm');
      const accountSelectFull = document.getElementById('account-select-full');
      const accountSelectPartial = document.getElementById('account-select-partial');
      const paymentAmountInput = document.getElementById('payment-amount');
      const amountDue = document.getElementById('amount-due');

      fullAmountBtn.addEventListener('click', () => {
        fullAmountPay.style.display = 'block';
        partialAmountPay.style.display = 'none';
      });

      partialAmountBtn.addEventListener('click', () => {
        partialAmountPay.style.display = 'block';
        fullAmountPay.style.display = 'none';
      });

      cancelBtns.forEach((cancelBtn) => {
        cancelBtn.addEventListener('click', () => {
          fullAmountPay.style.display = 'none';
          partialAmountPay.style.display = 'none';
        });
      });

      function payFullAmount() {
      
        // alert('Payment settled successfully. Thank you!');
        // amountDue.textContent = 'No Bills to Pay';
        // fullAmountPay.style.display = 'none';

        var accid=document.getElementById("account-select-full").value;
        var balanceid;
        if(accid == "222222222222"){
          balanceid="2-balance";
        }else if(accid == "111111111111"){
          balanceid="1-balance";
        }else if((accid == "333333333333")){
          balanceid="3-balance";
        }else{
          alert("Please choose an account to pay from.");
          return;
        }

        var storedBalance = parseFloat(localStorage.getItem(balanceid)); //40000.00
        var storedBill = parseFloat(localStorage.getItem("ccbill1"));
        if(storedBill>storedBalance){
         alert("You do not have enough in your account for this transaction.");
            return;
        }else{
          alert("Successful Transaction.");
          updateBalance(balanceid, storedBill, storedBill);
          updateTransaction(accid, storedBill);
                
          document.getElementById("account-select-full").value="";
          document.getElementById("full-amount-pay").style="none";
          var element = document.getElementById("ccbill1page");
          element.textContent = localStorage.getItem("ccbill1");
                
        }
      }

      function payPartialAmount() {
        const amount = parseFloat(paymentAmountInput.value);
        var storedBill = parseFloat(localStorage.getItem("ccbill1"));
        
        if (amount > storedBill) {
          alert('The entered amount exceeds the required amount. Please enter a valid amount within the limits.');
          return;
        } else if (amount<50){
          alert('The entered amount is below the minimum requirement. Please enter a valid amount within the limits (Minimum: 50.00 and Maximum 30,000.00).');
          return;
        }

            var accid=document.getElementById("account-select-partial").value;
            var balanceid;
            if(accid == "222222222222"){
            balanceid="2-balance";
            }else if(accid == "111111111111"){
              balanceid="1-balance";
            }else if((accid == "333333333333")){
              balanceid="3-balance";
            }else{
              alert("Please choose an account to pay from.");
              return;
            }

            var storedBalance = parseFloat(localStorage.getItem(balanceid)); //40000.00
             //
            if(amount>storedBalance){
                alert("You do not have enough in your account for this transaction.");
                return;
            }else{
                alert("Successful Transaction.");
                updateBalance(balanceid, amount, storedBill);
                updateTransaction(accid, amount);
                
                document.getElementById("account-select-partial").value="";
                document.getElementById("payment-amount").value="";
                document.getElementById("partial-amount-pay").style="none";
                var element = document.getElementById("ccbill1page");
                element.textContent = localStorage.getItem("ccbill1");
            }
      }



      document.addEventListener("DOMContentLoaded", function() {
        var element = document.getElementById("ccbill1page");
        element.textContent = localStorage.getItem("ccbill1");
      });

      function updateBalance(balanceid, amount, storedBill){
            
            var storedBalance = parseFloat(localStorage.getItem(balanceid));

            var newbalance=parseFloat(storedBalance)-parseFloat(amount);
            localStorage.setItem(balanceid, newbalance.toFixed(2));

            var newbill=parseFloat(storedBill)-parseFloat(amount);
            localStorage.setItem("ccbill1", newbill);


        }

        function updateTransaction(accid, amount){
            var newtransaction =
            {
                "Date": "01-06-2023",
                "Amount": parseFloat(amount)
            };

            var transid;
            if(accid == "222222222222"){
                transid="transactions2";
            }else if(accid == "111111111111"){
                transid="transactions1";
            }else{
                transid="transactions3";
            }


            var transactions = JSON.parse(localStorage.getItem(transid)) || [];
            
            transactions.unshift(newtransaction);
            localStorage.setItem(transid, JSON.stringify(transactions));
            
        }


        var sidebartmp = document.getElementById("sidebar-id");
        var sidebarbuttontmp = document.getElementById("sidebar-button-id");
        sidebarbuttontmp.addEventListener("click", () => {
            if(sidebartmp.style.width === "45px"){
                sidebartmp.style.width = "200px";
                sidebarbuttontmp.style.left="180px";
            }else{
                sidebartmp.style.width = "45px";
                sidebarbuttontmp.style.left="23px";
            }
        });
    </script>
  </body>
</html>